# 云函数部署指南

## 📦 阶段1：用户认证模块

### 云函数列表

1. **login** - 微信登录
2. **getUserInfo** - 获取用户信息

### 技术栈

- **wx-server-sdk** - 获取微信用户 openid
- **@cloudbase/node-sdk** - 访问 MySQL 数据库

---

## 🚀 快速部署

### ⚠️ 重要提示

如果之前已经部署过，请 **重新部署** 以更新依赖！

### 步骤1：上传云函数

在微信开发者工具中：

1. 右键 `cloudfunctions/login` 文件夹
2. 选择 **「上传并部署：云端安装依赖」**
3. 等待部署完成（约2-3分钟）
4. 重复上述步骤部署 `getUserInfo`

**注意：** 必须选择"云端安装依赖"，系统会自动安装 wx-server-sdk 和 @cloudbase/node-sdk

### 步骤2：配置云开发环境

在 `src/App.vue` 中添加：

```javascript
export default {
  onLaunch() {
    wx.cloud.init({
      env: 'your-env-id', // 替换为你的云开发环境ID
      traceUser: true
    });
  }
}
```

### 步骤3：访问测试中心

1. 编译运行小程序
2. 点击底部 **「测试」** 标签
3. 进入测试中心
4. 点击 **「登录认证测试」**
5. 执行测试

---

## ✅ 验收标准

- [ ] 云函数上传成功
- [ ] 底部 tabBar 显示"测试"标签
- [ ] 点击测试标签进入测试中心
- [ ] 登录测试通过
- [ ] 用户信息查询通过
- [ ] 数据库有用户记录

---

## 🔍 调试

### 查看云函数日志

云开发控制台 → 云函数 → 选择函数 → 日志

### 查看数据库

云开发控制台 → 数据库 → rx_user 表

---

## 📱 测试入口

**位置：** 底部 tabBar → 测试

**功能：**
- 阶段1：用户认证测试 ✅
- 阶段2：实验室模块 🚧
- 阶段3：排课申请 📋
- 阶段4：管理员审核 📋
- 阶段5：自动排课 📋

---

更新时间：2025-11-03
