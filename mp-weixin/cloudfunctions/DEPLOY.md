# ğŸš€ äº‘å‡½æ•°éƒ¨ç½²æ­¥éª¤ï¼ˆå¾®ä¿¡å¼€å‘è€…å·¥å…·ï¼‰

## âš ï¸ é‡è¦è¯´æ˜

ä½ ç°åœ¨ä½¿ç”¨çš„æ˜¯ **ç¼–è¯‘åçš„ mp-weixin ç›®å½•**ï¼Œäº‘å‡½æ•°åœ¨è¿™é‡Œä¿®æ”¹å’Œéƒ¨ç½²ã€‚

---

## ğŸ“¦ å½“å‰äº‘å‡½æ•°åˆ—è¡¨

### å¯ç”¨äº‘å‡½æ•°

1. **test** - åŸºç¡€æµ‹è¯•äº‘å‡½æ•°
   - æµ‹è¯•äº‘å¼€å‘ç¯å¢ƒ
   - æµ‹è¯• openid è·å–
   - æ— æ•°æ®åº“æ“ä½œ

2. **login** - ç™»å½•äº‘å‡½æ•°ï¼ˆç®€åŒ–ç‰ˆï¼‰
   - è·å–å¾®ä¿¡ç”¨æˆ· openid
   - è¿”å›ä¸´æ—¶ç”¨æˆ·æ•°æ®
   - **æš‚æ—¶ä¸è®¿é—®æ•°æ®åº“**

3. **getUserInfo** - æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼ˆç®€åŒ–ç‰ˆï¼‰
   - ä½¿ç”¨äº‘æ•°æ®åº“ï¼ˆä¸æ˜¯MySQLï¼‰
   - **æš‚æ—¶ä¸è®¿é—®MySQL**

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤1ï¼šéƒ¨ç½² test äº‘å‡½æ•°ï¼ˆåŸºç¡€æµ‹è¯•ï¼‰

1. åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­
2. æ‰¾åˆ° `mp-weixin/cloudfunctions/test` æ–‡ä»¶å¤¹
3. **å³é”®** â†’ é€‰æ‹© **ã€Œä¸Šä¼ å¹¶éƒ¨ç½²ï¼šäº‘ç«¯å®‰è£…ä¾èµ–ã€**
4. ç­‰å¾…éƒ¨ç½²å®Œæˆï¼ˆçº¦1-2åˆ†é’Ÿï¼‰

### æ­¥éª¤2ï¼šæµ‹è¯• test äº‘å‡½æ•°

åœ¨æ§åˆ¶å°æ‰§è¡Œï¼š

```javascript
wx.cloud.callFunction({
  name: 'test',
  data: {}
}).then(res => {
  console.log('âœ… test äº‘å‡½æ•°æˆåŠŸ:', res)
}).catch(err => {
  console.error('âŒ test äº‘å‡½æ•°å¤±è´¥:', err)
})
```

**é¢„æœŸç»“æœï¼š**
```javascript
{
  result: {
    success: true,
    data: {
      openid: "oXXXX...",
      appid: "wxXXXX...",
      ...
    }
  }
}
```

### æ­¥éª¤3ï¼šéƒ¨ç½² login äº‘å‡½æ•°

1. å³é”® `mp-weixin/cloudfunctions/login` æ–‡ä»¶å¤¹
2. é€‰æ‹© **ã€Œä¸Šä¼ å¹¶éƒ¨ç½²ï¼šäº‘ç«¯å®‰è£…ä¾èµ–ã€**
3. ç­‰å¾…å®Œæˆ

### æ­¥éª¤4ï¼šæµ‹è¯•ç™»å½•

1. ç‚¹å‡»åº•éƒ¨"æµ‹è¯•"æ ‡ç­¾
2. è¿›å…¥"ç™»å½•è®¤è¯æµ‹è¯•"
3. ç‚¹å‡»"ğŸš€ æ‰§è¡Œæµ‹è¯•"

**é¢„æœŸç»“æœï¼š**
- âœ… æ˜¾ç¤º"ç™»å½•æˆåŠŸï¼ˆæµ‹è¯•ç‰ˆæœ¬ï¼‰"
- âœ… èƒ½çœ‹åˆ° openid
- âœ… è¿”å›ä¸´æ—¶ç”¨æˆ·æ•°æ®

---

## ğŸ” æŸ¥çœ‹äº‘å‡½æ•°æ—¥å¿—

**éå¸¸é‡è¦ï¼šæ¯æ¬¡æµ‹è¯•åéƒ½è¦æŸ¥çœ‹æ—¥å¿—ï¼**

### æ­¥éª¤ï¼š

1. å¾®ä¿¡å¼€å‘è€…å·¥å…· â†’ ç‚¹å‡»é¡¶éƒ¨ **ã€Œäº‘å¼€å‘ã€**
2. ç‚¹å‡»å·¦ä¾§ **ã€Œäº‘å‡½æ•°ã€**
3. ç‚¹å‡»å…·ä½“çš„äº‘å‡½æ•°ï¼ˆå¦‚ `login`ï¼‰
4. ç‚¹å‡» **ã€Œæ—¥å¿—ã€** æ ‡ç­¾
5. æŸ¥çœ‹æœ€æ–°çš„æ—¥å¿—

### æ­£å¸¸æ—¥å¿—åº”è¯¥æ˜¾ç¤ºï¼š

```
[LOGIN] äº‘å‡½æ•°å¼€å§‹æ‰§è¡Œ
[LOGIN] wxContext: { OPENID: 'oXXX...', ... }
[LOGIN] æˆåŠŸè·å– openid: oXXX...
[LOGIN] ç™»å½•æˆåŠŸï¼Œè¿”å›æ•°æ®: {...}
```

### å¦‚æœæœ‰é”™è¯¯ï¼š

æ—¥å¿—ä¼šæ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯å †æ ˆï¼Œå¤åˆ¶ç»™æˆ‘ï¼

---

## â“ å…³äºæ•°æ®åº“çš„è¯´æ˜

### å½“å‰ä½¿ç”¨ï¼šäº‘æ•°æ®åº“ï¼ˆNoSQLï¼‰

ç®€åŒ–ç‰ˆäº‘å‡½æ•°ä½¿ç”¨çš„æ˜¯ **å¾®ä¿¡äº‘å¼€å‘çš„äº‘æ•°æ®åº“**ï¼ˆNoSQLï¼‰ï¼Œä¸æ˜¯ MySQLã€‚

åŸå› ï¼š
- âœ… ä¸ `wx-server-sdk` å®Œç¾å…¼å®¹
- âœ… æ— éœ€é¢å¤–é…ç½®
- âœ… æ€§èƒ½å¥½ï¼Œæ˜“äºä½¿ç”¨
- âœ… ä¸ä¼šå‡ºç° -504002 é”™è¯¯

### å¦‚æœéœ€è¦ä½¿ç”¨ MySQL

éœ€è¦ï¼š
1. åœ¨äº‘å¼€å‘æ§åˆ¶å°åˆ›å»º MySQL å®ä¾‹
2. é…ç½®æ•°æ®åº“è¿æ¥
3. ä½¿ç”¨ `@cloudbase/node-sdk` è®¿é—®
4. å¯èƒ½éœ€è¦åˆ†ç¦»æ•°æ®åº“æ“ä½œåˆ°ç‹¬ç«‹äº‘å‡½æ•°

### å»ºè®®

**å…ˆç”¨äº‘æ•°æ®åº“æµ‹è¯•é€šè¿‡åŸºç¡€åŠŸèƒ½ï¼Œç„¶åå†è€ƒè™‘ MySQLã€‚**

---

## ğŸ“Š æµ‹è¯•æµç¨‹

```
1. éƒ¨ç½² test äº‘å‡½æ•°
   â†“
2. æ§åˆ¶å°æµ‹è¯• test äº‘å‡½æ•°
   â†“
3. ç¡®è®¤ openid è·å–æ­£å¸¸
   â†“
4. éƒ¨ç½² login äº‘å‡½æ•°
   â†“
5. æµ‹è¯•é¡µé¢æµ‹è¯•ç™»å½•
   â†“
6. æŸ¥çœ‹äº‘å‡½æ•°æ—¥å¿—
   â†“
7. ç¡®è®¤ç™»å½•æˆåŠŸ
```

---

## âœ… éªŒæ”¶æ ‡å‡†

### test äº‘å‡½æ•°

- [ ] éƒ¨ç½²æˆåŠŸ
- [ ] æ§åˆ¶å°æµ‹è¯•æˆåŠŸ
- [ ] èƒ½è·å–åˆ° openid
- [ ] æ—¥å¿—æ— é”™è¯¯

### login äº‘å‡½æ•°

- [ ] éƒ¨ç½²æˆåŠŸ
- [ ] æµ‹è¯•é¡µé¢è°ƒç”¨æˆåŠŸ
- [ ] è¿”å›ç”¨æˆ·ä¿¡æ¯
- [ ] æ—¥å¿—æ˜¾ç¤ºæ­£å¸¸æµç¨‹

---

## ğŸ¯ ä¸‹ä¸€æ­¥

### å¦‚æœæµ‹è¯•é€šè¿‡

å‘Šè¯‰æˆ‘ï¼š"åŸºç¡€æµ‹è¯•é€šè¿‡"

æˆ‘ä¼šå¸®ä½ ï¼š
1. å†³å®šä½¿ç”¨äº‘æ•°æ®åº“è¿˜æ˜¯ MySQL
2. å®Œå–„æ•°æ®å­˜å‚¨åŠŸèƒ½
3. è¿›å…¥ä¸‹ä¸€é˜¶æ®µå¼€å‘

### å¦‚æœæµ‹è¯•å¤±è´¥

å‘Šè¯‰æˆ‘ï¼š
1. å®Œæ•´çš„é”™è¯¯ä¿¡æ¯
2. äº‘å‡½æ•°æ—¥å¿—å†…å®¹
3. å“ªä¸ªæ­¥éª¤å¤±è´¥äº†

---

## ğŸ’¡ å¿«é€Ÿå‘½ä»¤

### æµ‹è¯• test äº‘å‡½æ•°ï¼ˆæ§åˆ¶å°æ‰§è¡Œï¼‰

```javascript
wx.cloud.callFunction({
  name: 'test',
  data: {}
}).then(res => console.log('âœ…', res))
  .catch(err => console.error('âŒ', err))
```

### æµ‹è¯• login äº‘å‡½æ•°ï¼ˆæ§åˆ¶å°æ‰§è¡Œï¼‰

```javascript
wx.cloud.callFunction({
  name: 'login',
  data: {
    nickName: 'æµ‹è¯•ç”¨æˆ·',
    avatarUrl: ''
  }
}).then(res => console.log('âœ…', res))
  .catch(err => console.error('âŒ', err))
```

---

ç°åœ¨å¼€å§‹éƒ¨ç½²æµ‹è¯•å§ï¼ğŸ‰

